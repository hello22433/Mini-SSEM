# ğŸ’° Mini-SSEM : High-Traffic Tax Engine

> **"5ì›”ì˜ í­ì£¼í•˜ëŠ” íŠ¸ë˜í”½ì—ë„ ë©ˆì¶”ì§€ ì•ŠëŠ”, ê°€ì¥ ì•ˆì „í•œ ì„¸ê¸ˆ ê³„ì‚° ì—”ì§„"**
>
> **ê²½ì œí•™ ì „ê³µì**ì˜ ë„ë©”ì¸ ì§€ì‹ê³¼ **ë°±ì—”ë“œ ê°œë°œì**ì˜ ëŒ€ìš©ëŸ‰ íŠ¸ë˜í”½ ì²˜ë¦¬ ê¸°ìˆ ì„ ê²°í•©í•˜ì—¬,
> ë„ë¦¬ì†Œí”„íŠ¸(SSEM)ì˜ í•µì‹¬ ê°€ì¹˜ì¸ '**ê¸ˆìœµ ë°ì´í„° ì •í•©ì„±**'ê³¼ '**ì‹œìŠ¤í…œ ì•ˆì •ì„±**'ì„ êµ¬í˜„í•œ í”„ë¡œí† íƒ€ì…ì…ë‹ˆë‹¤.

---

## 1. Project Overview (í”„ë¡œì íŠ¸ ê°œìš”)

ì¢…í•©ì†Œë“ì„¸ ì‹ ê³  ê¸°ê°„(5ì›”)ê³¼ ê°™ì´ **ì˜ˆì¸¡ ë¶ˆê°€ëŠ¥í•œ íŠ¸ë˜í”½ í­ì£¼ ìƒí™©**ì—ì„œë„, **ì„œë²„ ë‹¤ìš´ ì—†ì´ ì•ˆì •ì ìœ¼ë¡œ ì„¸ê¸ˆ ê³„ì‚° ìš”ì²­ì„ ì²˜ë¦¬**í•˜ê¸° ìœ„í•´ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

* **Target:** ë„ë¦¬ì†Œí”„íŠ¸(SSEM) ë°±ì—”ë“œ ì‹œìŠ¤í…œì˜ í•µì‹¬ ë¡œì§ ì‹œë®¬ë ˆì´ì…˜
* **Core Goal:** ëŒ€ê·œëª¨ íŠ¸ë˜í”½ ë¶„ì‚° ì²˜ë¦¬, ê¸ˆìœµ ë°ì´í„° ë¬´ê²°ì„± ë³´ì¥, ìš´ì˜ ê´€ì¸¡ì„±(Observability) í™•ë³´
* **Key Tech:** Spring Boot, RabbitMQ, Redis, Flyway, Bucket4j, Prometheus & Grafana

---

## 2. System Architecture (ì•„í‚¤í…ì²˜)

*(ì•„í‚¤í…ì²˜ ë‹¤ì´ì–´ê·¸ë¨ ì´ë¯¸ì§€ë¥¼ ì—¬ê¸°ì— ì‚½ì…í•´ì£¼ì„¸ìš”)*

1.  **Rate Limiter (Interceptor):** ë¹„ì •ìƒì ì¸ íŠ¸ë˜í”½ í­ì£¼ ì‹œ, `HandlerInterceptor` ë ˆë²¨ì—ì„œ ìš”ì²­ì„ ì¡°ê¸°ì— ì°¨ë‹¨í•˜ì—¬ ì„œë²„ ë¦¬ì†ŒìŠ¤ë¥¼ ë³´í˜¸í•©ë‹ˆë‹¤.
2.  **Caching (Redis):** ì½ê¸° ì„±ëŠ¥ ìµœì í™”ë¥¼ ìœ„í•œ Look-aside Cache ì „ëµì„ ì ìš©í•˜ì—¬ RDBMS ë¶€í•˜ë¥¼ ì¤„ì…ë‹ˆë‹¤.
3.  **Async Queueing (RabbitMQ):** ì‚¬ìš©ìì˜ ì“°ê¸°(Write) ìš”ì²­ì„ í(Queue)ì— ì ì¬í•˜ì—¬, ì›Œì»¤(Worker)ê°€ ì²˜ë¦¬ ê°€ëŠ¥í•œ ì†ë„ë¡œ ì†Œë¹„í•©ë‹ˆë‹¤.
4.  **Data Integrity (Transactional):** `BigDecimal`ì„ í†µí•œ ì •ë°€ ì„¸ê¸ˆ ê³„ì‚° ë° `Outbox Pattern`,`DLQ`ë¥¼ í†µí•œ ë°ì´í„° ìœ ì‹¤ ë°©ì§€.
5.  **Observability (Monitoring):** Actuatorì™€ Prometheus, Grafanaë¥¼ ì—°ë™í•˜ì—¬ í ëŒ€ê¸°ì—´ê³¼ ì„œë²„ ìƒíƒœë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ì‹œê°í™”í•©ë‹ˆë‹¤.

---

## 3. Key Solutions (í•µì‹¬ ë¬¸ì œ í•´ê²° ì „ëµ)

ë„ë¦¬ì†Œí”„íŠ¸ì˜ ì±„ìš© ê³µê³ ì™€ ê¸°ìˆ  ë¸”ë¡œê·¸ì—ì„œ íŒŒì•…í•œ '**ì‹¤ì œ ìš´ì˜ìƒì˜ Pain Point**'ë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì€ ê¸°ìˆ ì„ ë„ì…í–ˆìŠµë‹ˆë‹¤.

### ğŸ›¡ï¸ 1. íŠ¸ë˜í”½ ì œì–´: "ì„œë²„ ë‹¤ìš´ì„ ë§‰ëŠ” ë¬¸ì§€ê¸°" (Interceptor & Bucket4j)
* **Problem:** ì‹ ê³  ë§ˆê°ì¼ ë“± íŠ¸ë˜í”½ í”¼í¬ íƒ€ì„ì— ìš”ì²­ì´ ëª°ë ¤ DB ì»¤ë„¥ì…˜ì´ ê³ ê°ˆë˜ê³  ì„œë²„ê°€ ë‹¤ìš´ë˜ëŠ” í˜„ìƒ.
* **Solution:**
    * **`HandlerInterceptor` + `Bucket4j` ì ìš©:** ì»¨íŠ¸ë¡¤ëŸ¬ ì§„ì… ì „ ì¸í„°ì…‰í„° ë‹¨ê³„ì—ì„œ **Token Bucket ì•Œê³ ë¦¬ì¦˜**ì„ í†µí•´ ì´ˆë‹¹ í—ˆìš©ëŸ‰(TPS)ì„ ì œì–´í•©ë‹ˆë‹¤.
    * **Effect:** í—ˆìš©ëŸ‰ì„ ì´ˆê³¼í•˜ëŠ” ìš”ì²­ì€ `429 Too Many Requests`ë¡œ ì¡°ê¸°ì— ê±°ì ˆí•˜ì—¬, í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ê³¼ DBë¥¼ ë³´í˜¸í•©ë‹ˆë‹¤.

> **ğŸ’¡ Why Interceptor? (Gateway vs Application Level)**
> ë¬¼ë¡  Nginxë‚˜ API Gateway ì•ë‹¨ì—ì„œ ë§‰ëŠ” ê²ƒì´ ë„¤íŠ¸ì›Œí¬ ë¦¬ì†ŒìŠ¤ ì°¨ì›ì—ì„œëŠ” íš¨ìœ¨ì ì…ë‹ˆë‹¤.
> í•˜ì§€ë§Œ ì €ëŠ” **ì• í”Œë¦¬ì¼€ì´ì…˜ ë‚´ë¶€ ì •ì±…** (**ì‚¬ìš©ì ë“±ê¸‰ë³„ ì œí•œ, íŠ¹ì • APIë³„ ì •ë°€ ì œì–´**)ê³¼ ê²°í•©ëœ ìœ ì—°í•œ ì œì–´ê°€ í•„ìš”í•˜ë‹¤ê³  íŒë‹¨í–ˆìŠµë‹ˆë‹¤. ë˜í•œ, ì™¸ë¶€ ì¸í”„ë¼ ì˜ì¡´ì„±ì„ ì¤„ì´ê³  ì• í”Œë¦¬ì¼€ì´ì…˜ ìì²´ì ìœ¼ë¡œ **Self-Protection** ëŠ¥ë ¥ì„ ê°–ì¶”ê¸° ìœ„í•´ ì¸í„°ì…‰í„° ë°©ì‹ì„ ì„ íƒí–ˆìŠµë‹ˆë‹¤.

### âš¡ 2. ì„±ëŠ¥ ìµœì í™”: "DB ë¶€í•˜ 90% ê°ì†Œ" (Redis Caching)
* **Problem:** ì„¸ê¸ˆ ê³„ì‚° ê²°ê³¼ ì¡°íšŒ(Read) íŠ¸ë˜í”½ì´ ëª°ë¦´ ê²½ìš° RDBMS ë¶€í•˜ê°€ ê¸‰ì¦í•˜ì—¬ ì „ì²´ ì„œë¹„ìŠ¤ ì‘ë‹µ ì†ë„ ì €í•˜.
* **Solution:**
    * **`Redis` ë„ì…:** ê³„ì‚° ì™„ë£Œ(`COMPLETED`)ëœ ë¶ˆë³€ ë°ì´í„°ëŠ” Redisì— ìºì‹±í•˜ëŠ” **Look-aside ì „ëµ**ì„ ì ìš©í–ˆìŠµë‹ˆë‹¤.
    * **Effect:** ë°˜ë³µë˜ëŠ” ì¡°íšŒ ìš”ì²­ì„ ë©”ëª¨ë¦¬(Redis)ì—ì„œ 1ms ì´ë‚´ì— ì²˜ë¦¬í•˜ì—¬ RDBMS ë¶€í•˜ë¥¼ íšê¸°ì ìœ¼ë¡œ ë‚®ì·„ìŠµë‹ˆë‹¤.

### ğŸ“‰ 3. ê´€ì¸¡ ê°€ëŠ¥ì„± í™•ë³´: "ë³´ì´ì§€ ì•Šìœ¼ë©´ ê´€ë¦¬í•  ìˆ˜ ì—†ë‹¤" (Prometheus & Grafana)
* **Problem:** ì„œë¹„ìŠ¤ ì§€ì—° ì‹œ ë³‘ëª© êµ¬ê°„ì´ DBì¸ì§€, íì¸ì§€, ì• í”Œë¦¬ì¼€ì´ì…˜ì¸ì§€ íŒŒì•…í•˜ê¸° ì–´ë ¤ì›€.
* **Solution:**
    * **Spring Actuator**ë¡œ ì• í”Œë¦¬ì¼€ì´ì…˜ì˜ ë©”íŠ¸ë¦­(Metric)ì„ ë…¸ì¶œí•˜ê³ , **Prometheus**ê°€ ì´ë¥¼ ìˆ˜ì§‘í•©ë‹ˆë‹¤.
    * **Grafana Dashboard**ë¥¼ êµ¬ì¶•í•˜ì—¬ **'í˜„ì¬ ëŒ€ê¸° ì¤‘ì¸ ì‹ ê³  ìš”ì²­ ìˆ˜(RabbitMQ Depth)**'ì™€ **'JVM ë©”ëª¨ë¦¬ ìƒíƒœ**'ë¥¼ ì‹¤ì‹œê°„ìœ¼ë¡œ ëª¨ë‹ˆí„°ë§í•©ë‹ˆë‹¤.
    * **Effect:** ì¥ì•  ë°œìƒ ì‹œ ë¡œê·¸ë¥¼ ë’¤ì§€ëŠ” ëŒ€ì‹ , ëŒ€ì‹œë³´ë“œë¥¼ í†µí•´ ì¦‰ê°ì ì¸ ì›ì¸ íŒŒì•… ë° ëŒ€ì‘ì´ ê°€ëŠ¥í•´ì¡ŒìŠµë‹ˆë‹¤.

### ğŸ—ï¸ 4. ë°°í¬ ì•ˆì •ì„±: "ê¸°ë„ ë©”íƒ€ëŠ” ê·¸ë§Œ" (Flyway)
* **Problem:** ì‹œìŠ¤í…œ ê³ ë„í™” ê³¼ì •ì—ì„œ DB ìŠ¤í‚¤ë§ˆ ë¶ˆì¼ì¹˜ë¡œ ì¸í•œ ë°°í¬ ì¥ì•  ë°œìƒ ê°€ëŠ¥ì„±.
* **Solution:**
    * **Flyway**ë¥¼ ë„ì…í•˜ì—¬ ëª¨ë“  DB ìŠ¤í‚¤ë§ˆ ë³€ê²½(DDL)ì„ SQL ìŠ¤í¬ë¦½íŠ¸ë¡œ ë²„ì „ ê´€ë¦¬í•©ë‹ˆë‹¤.
    * JPAì˜ `ddl-auto`ì— ì˜ì¡´í•˜ì§€ ì•Šê³ , ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ë ¥ì„ ì¶”ì í•˜ì—¬ ë°°í¬ ì‹¤íŒ¨ ë¦¬ìŠ¤í¬ë¥¼ ìµœì†Œí™”í–ˆìŠµë‹ˆë‹¤.

### ğŸ’° 5. ê¸ˆìœµ ì •í•©ì„±: "1ì›ì˜ ì˜¤ì°¨ë„ í—ˆìš©í•˜ì§€ ì•ŠìŒ" (Economic Logic)
* **Problem:** ë¶€ë™ì†Œìˆ˜ì  ì˜¤ì°¨ ë° ë³µì¡í•œ ëˆ„ì§„ì„¸ìœ¨ ê³„ì‚° ë¡œì§ì˜ ìœ ì§€ë³´ìˆ˜ ì–´ë ¤ì›€.
* **Solution:**
    * ëª¨ë“  ê¸ˆì „ ë°ì´í„°ì— `BigDecimal`ì„ ì ìš©í•˜ì—¬ ì—°ì‚° ì •ë°€ë„ë¥¼ ë³´ì¥í–ˆìŠµë‹ˆë‹¤.
    * ë§¤ë…„ ê°œì •ë˜ëŠ” ì„¸ë²•ì„ ìœ ì—°í•˜ê²Œ ë°˜ì˜í•˜ê¸° ìœ„í•´(OCP ì›ì¹™ ì¤€ìˆ˜) **ì „ëµ íŒ¨í„´**(**Strategy Pattern**)ì„ ì‚¬ìš©í•˜ì—¬ `TaxPolicy2024`, `TaxPolicy2025` ë“±ìœ¼ë¡œ ë¡œì§ì„ ê²©ë¦¬í–ˆìŠµë‹ˆë‹¤.

---

## 4. Stability Verification (ì•ˆì •ì„± ê²€ì¦)

Bucket4j(Rate Limiter)ê°€ ì‹¤ì œ íŠ¸ë˜í”½ í­ì£¼ ìƒí™©ì—ì„œ ì„œë²„ë¥¼ ë³´í˜¸í•˜ëŠ”ì§€ ê²€ì¦í•˜ê¸° ìœ„í•´ **k6** ë¶€í•˜ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.

### ğŸ§ª Load Test Scenario
* **Virtual Users:** 100ëª… ë™ì‹œ ì ‘ì† (ì§€ì†ì ì¸ íŠ¸ë˜í”½ ê³µê²©)
* **Goal:** TPS í•œê³„ë¥¼ ì´ˆê³¼í•˜ëŠ” ìš”ì²­ì— ëŒ€í•´ `500 Error`(ì„œë²„ ë‹¤ìš´) ëŒ€ì‹  `429 Error`(ë°©ì–´)ë¥¼ ë°˜í™˜í•˜ëŠ”ì§€ ê²€ì¦.

### ğŸ“Š Result
*(k6 ì‹¤í–‰ ê²°ê³¼ í„°ë¯¸ë„ ìº¡ì²˜ ì´ë¯¸ì§€ë¥¼ ì—¬ê¸°ì— ì‚½ì…í•´ì£¼ì„¸ìš”)*

* **Total Requests:** ì•½ 8,000ê±´
* **Success (200 OK):** ì„¤ì •ëœ TPS ì¤€ìˆ˜
* **Rejected (429 Too Many Requests):** ì´ˆê³¼ íŠ¸ë˜í”½ ë°©ì–´ ì„±ê³µ
* **Server Error (500):** **0ê±´ (ê°€ìš©ì„± 100% í™•ë³´)**

> **ê²°ë¡ :** íŠ¸ë˜í”½ ê³¼ë¶€í•˜ ì‹œì—ë„ Rate Limiterê°€ ì •ìƒ ì‘ë™í•˜ì—¬ DB ì»¤ë„¥ì…˜ ê³ ê°ˆì„ ë°©ì§€í•˜ê³  ì‹œìŠ¤í…œ ì•ˆì •ì„±ì„ ìœ ì§€í•¨ì„ ì…ì¦í–ˆìŠµë‹ˆë‹¤.

---

## 5. Tech Stack & Directory Structure

* **Language:** Java 17
* **Framework:** Spring Boot 3.x, Spring Data JPA
* **Database:** MySQL 8.0, Redis, Flyway
* **Messaging:** RabbitMQ (with Dead Letter Queue)
* **Traffic Control:** Bucket4j, Spring Interceptor
* **Monitoring:** Spring Actuator, Prometheus, Grafana
* **Test:** JUnit5, Mockito, k6 (Load Testing)
* **Infra:** Docker Compose

### ğŸ“‚ Directory Structure (DDD)
ê²½ì œí•™ ì „ê³µìë¡œì„œ **ì„¸ê¸ˆ ê³„ì‚° ë¡œì§**(**Domain**)ì˜ ìˆœìˆ˜ì„±ì„ ì§€í‚¤ê¸° ìœ„í•´ ë„ë©”ì¸ê³¼ ì¸í”„ë¼ë¥¼ ë¶„ë¦¬í–ˆìŠµë‹ˆë‹¤.

```text
src/main/java/com/minissem
â”œâ”€â”€ domain          # [í•µì‹¬] ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ (ìˆœìˆ˜ Java, ì„¸ë²• êµ¬í˜„)
â”œâ”€â”€ infra           # [êµ¬í˜„] RabbitMQ, JPA, Redis êµ¬í˜„ì²´
â”œâ”€â”€ api             # [ì™¸ë¶€] Controller (Rate Limiter ì ìš©)
â””â”€â”€ global          # [ì„¤ì •] Config, Exception Handler
````

-----

## 6\. How to Run (ì‹¤í–‰ ë°©ë²•)

ë³µì¡í•œ ì„¤ì¹˜ ê³¼ì • ì—†ì´ **Docker Compose**ë¥¼ í†µí•´ ì¸í”„ë¼ë¥¼ ì¦‰ì‹œ êµ¬ì¶•í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### Prerequisites

* Docker & Docker Compose

### Steps

1.  **ì¸í”„ë¼ ì‹¤í–‰ (MySQL, RabbitMQ, Redis, Prometheus, Grafana)**
    ```bash
    docker-compose up -d
    ```
2.  **ì• í”Œë¦¬ì¼€ì´ì…˜ ì‹¤í–‰**
    ```bash
    ./gradlew bootRun
    ```
3.  **ê¸°ëŠ¥ í…ŒìŠ¤íŠ¸**
    * ì„¸ê¸ˆ ì‹ ê³  ìš”ì²­: `POST /api/tax/calculate`
    * ê²°ê³¼ ì¡°íšŒ (ìºì‹±): `GET /api/tax/{requestId}`
    * ëª¨ë‹ˆí„°ë§ ëŒ€ì‹œë³´ë“œ: `http://localhost:3001` (Grafana)

-----

## ğŸ“® Contact

* **Email:** prettywang777@gmail.com
* **Blog:** https://velog.io/@hello22433/posts
* **Note:** ì´ í”„ë¡œì íŠ¸ëŠ” ë„ë¦¬ì†Œí”„íŠ¸ì˜ ë¹„ì „ì¸ "**ëª¨ë‘ê°€ ìµœì €ì„¸ê¸ˆìœ¼ë¡œ**"ì— ê¸°ì—¬í•  ìˆ˜ ìˆëŠ” ê¸°ìˆ ì  ì—­ëŸ‰ì„ ì¦ëª…í•˜ê¸° ìœ„í•´ ì œì‘ë˜ì—ˆìŠµë‹ˆë‹¤.
